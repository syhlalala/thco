;	8000	字符放置位置
;	F800	显存位置
;
;
;
;
;

NOP
NOP
	;init
	LI R1 0x40
	SLL R1 R1 0x0
	MTSP R1
	LI R1 0x90
	SLL R1 R1 0x0
	LI R0 0x0
	SW R1 R0 0x0
	SW R1 R0 0x1
	SW R1 R0 0x2
	SW R1 R0 0x3

	LI R1 0x80
	SLL R1 R1 0x0
	LI R0 0x08
	SLL R0 R0 0x0
	LI R3 0x0
	INIT_MEMORY_LOOP:	;初始显存数据为0
		ADDIU R0 0xFF
		ADDU R1 R0 R2
		NOP
		SW R2 R3 0x0
		BNEZ R0 INIT_MEMORY_LOOP
		NOP

	MAIN_LOOP: 
	LI R1 0x80
	LI R0 0x08
	LI R4 0xF8
	SLL R1 R1 0x0
	SLL R0 R0 0x0
	SLL R4 R4 0x0
	REFRESH_VGA:	; 刷新VGA数据
		ADDIU R0 0xFF
		ADDU R0 R1 R2
		LW R2 R3 0x0
		ADDU R4 R0 R2
		SW R2 R3 0x0
		BNEZ R0 REFRESH_VGA
		NOP

	;键盘读入
	LI R4 0xBF
	SLL R4 R4 0x0
	KEY_CHECK:
		LW R4 R0 0x3
		BNEZ R0 WORK_AREA
		NOP

	UART_CHECK:
		LW R4 R0 0x1
		LI R2 0x2
		AND R0 R2
		BNEZ R0 WORK_AREA_UART
		NOP

	B KEY_CHECK
	NOP
;-----------------------KEY BOARD-------------
	WORK_AREA:
	NOP
	LW R4 R5 0x2
	LI R3 0x90
	SLL R3 R3 0x0
	LW R3 R0 0x0
	LW R3 R1 0x1


	LI R3 0x80
	SLL R3 R3 0x0
	ADDIU3 R1 R4 0x0
	SLL R4 R4 0x6
	ADDU R4 R0 R4
	ADDU R4 R3 R4
	NOP
	SW R4 R5 0x0


	ADDIU R0 0x1
	LI R3 0x14 ; 20
	CMP R0 R3
	BTNEZ END_CHANGE_LINE
	NOP
		ADDIU R1 0x1
		SUBU R0 R3 R0
		LI R4 0x1E ; 30
		MOVE_DOWN_1:
			LI R2 0x80
			SLL R2 R2 0x0
			ADDIU3 R4 R3 0x0
			SLL R3 R3 0x6
			ADDU R2 R3 R3
			ADDIU3 R3 R7 0x0
			LI R2 0x40
			SUBU R7 R2 R7
			LI R2 0x14 ; 20
			FOR_0:
				ADDIU R2 0xFF
				LW R7 R6 0x0
				SW R3 R6 0x0
				ADDIU R3 0x1
				ADDIU R7 0x1
				BNEZ R2 FOR_0
				NOP
			ADDIU R4 0xFF
			CMP R1 R4
			BTNEZ MOVE_DOWN_1
			NOP

		ADDIU3 R1 R2 0x0
		SLL R2 R2 0x6
		LI R3 0x80
		SLL R3 R3 0x0
		ADDU R3 R2 R2
		LI R3 0x14 ; 20
		LI R4 0x0
		CLEAR_LOOP_1:
			ADDIU R3 0xFF
			SW R2 R4 0x0
			ADDIU R2 0x1
			BNEZ R3 CLEAR_LOOP_1
			NOP
	END_CHANGE_LINE:
	NOP

	LI R2 0x1E
	CMP R2 R5
	BTNEZ END_ENTER
	NOP
		LI R0 0x0
		LI R1 0x0

		LI R4 0x1E ; 30
		MOVE_DOWN_2:
			LI R2 0x80
			SLL R2 R2 0x0
			ADDIU3 R4 R3 0x0
			SLL R3 R3 0x6
			ADDU R2 R3 R3
			ADDIU3 R3 R7 0x0
			LI R2 0x40
			SUBU R7 R2 R7
			LI R2 0x14 ; 20
			FOR_1:
				ADDIU R2 0xFF
				LW R7 R6 0x0
				SW R3 R6 0x0
				ADDIU R3 0x1
				ADDIU R7 0x1
				BNEZ R2 FOR_1
				NOP
			ADDIU R4 0xFF
			BNEZ R4 MOVE_DOWN_2
			NOP

		LI R2 0x80
		SLL R2 R2 0x0
		LI R3 0x14 ; 20
		LI R4 0x0
		CLEAR_LOOP_2:
			ADDIU R3 0xFF
			SW R2 R4 0x0
			ADDIU R2 0x1
			BNEZ R3 CLEAR_LOOP_2
			NOP
	END_ENTER:
	NOP

	LI R3 0x90
	SLL R3 R3 0x0
	SW R3 R0 0x0
	SW R3 R1 0x1

	LI R0 0xBF
	SLL R0 R0 0x0
	SW R0 R5 0x0

	B MAIN_LOOP
	NOP

;------------------------------UART-------------------------

	WORK_AREA_UART:
	NOP

	LW R4 R5 0x0
	LI R3 0x90
	SLL R3 R3 0x0
	LW R3 R0 0x2
	LW R3 R1 0x3


	LI R3 0x80
	SLL R3 R3 0x0
	ADDIU3 R1 R4 0x0
	SLL R4 R4 0x6
	ADDU R4 R0 R4
	ADDU R4 R3 R4
	ADDIU R4 0x0014 ; 20
	NOP
	SW R4 R5 0x0


	ADDIU R0 0x1
	LI R3 0x14 ; 20
	CMP R0 R3
	BTNEZ END_CHANGE_LINE_UART
	NOP
		ADDIU R1 0x1
		SUBU R0 R3 R0
		LI R4 0x1E ; 30
		MOVE_DOWN_3:
			LI R2 0x80
			SLL R2 R2 0x0
			ADDIU3 R4 R3 0x0
			SLL R3 R3 0x6
			ADDU R2 R3 R3
			ADDIU R3 0x0014 ; 20
			ADDIU3 R3 R7 0x0
			LI R2 0x40
			SUBU R7 R2 R7
			LI R2 0x14 ; 20
			FOR_2:
				ADDIU R2 0xFF
				LW R7 R6 0x0
				SW R3 R6 0x0
				ADDIU R3 0x1
				ADDIU R7 0x1
				BNEZ R2 FOR_2
				NOP
			ADDIU R4 0xFF
			CMP R1 R4
			BTNEZ MOVE_DOWN_3
			NOP

		ADDIU3 R1 R2 0x0
		SLL R2 R2 0x6
		LI R3 0x80
		SLL R3 R3 0x0
		ADDU R3 R2 R2
		ADDIU R2 0x0014 ; 20
		LI R3 0x14 ; 20
		LI R4 0x0
		CLEAR_LOOP_3:
			ADDIU R3 0xFF
			SW R2 R4 0x0
			ADDIU R2 0x1
			BNEZ R3 CLEAR_LOOP_3
			NOP
	END_CHANGE_LINE_UART:
	NOP

	LI R2 0x1E
	CMP R2 R5
	BTNEZ END_ENTER_UART
	NOP
		LI R0 0x0
		LI R1 0x0

		LI R4 0x1E ; 30
		MOVE_DOWN_4:
			LI R2 0x80
			SLL R2 R2 0x0
			ADDIU3 R4 R3 0x0
			SLL R3 R3 0x6
			ADDU R2 R3 R3
			ADDIU R3 0x0014 ; 20
			ADDIU3 R3 R7 0x0
			LI R2 0x40
			SUBU R7 R2 R7
			LI R2 0x14 ; 20
			FOR_3:
				ADDIU R2 0xFF
				LW R7 R6 0x0
				SW R3 R6 0x0
				ADDIU R3 0x1
				ADDIU R7 0x1
				BNEZ R2 FOR_3
				NOP
			ADDIU R4 0xFF
			BNEZ R4 MOVE_DOWN_4
			NOP

		LI R2 0x80
		SLL R2 R2 0x0
		ADDIU R2 0x0014 ; 20
		LI R3 0x14 ; 20
		LI R4 0x0
		CLEAR_LOOP_4:
			ADDIU R3 0xFF
			SW R2 R4 0x0
			ADDIU R2 0x1
			BNEZ R3 CLEAR_LOOP_4
			NOP
	END_ENTER_UART:
	NOP

	LI R3 0x90
	SLL R3 R3 0x0
	SW R3 R0 0x2
	SW R3 R1 0x3

	B MAIN_LOOP
	NOP
